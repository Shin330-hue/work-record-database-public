# 図面管理システム 公開版・ユーザー向け仕様書

## 1. 文書の目的
本書は、公開版 Web アプリを利用するユーザー向けに、
「何ができるか」「どの画面で何を操作するか」を定義した仕様書です。

## 2. 想定ユーザー
- 閲覧ユーザー
  - 図番を探して、図面・プログラム・作業内容を確認したい人
- 管理ユーザー
  - 図番や添付ファイル、追記情報を登録・更新したい人
- 現場作業者
  - 対象図番に対して最新の補足情報を追記したい人

## 3. 利用目的
- 取引先会社名や図番単位で、作業情報を整理し再利用しやすくする
- 現場ノウハウ（追記・補足情報）を参照できる状態にする
- 図番検索で必要な手順へ素早く到達する

## 4. 提供機能（ユーザー視点）

### 4.1 閲覧機能
- 会社 -> カテゴリ -> 図番の階層閲覧
- 図番/キーワード検索
- 作業手順詳細の閲覧
- 添付ファイル（PDF/画像/動画/プログラム）の参照
- 全追記一覧の閲覧

### 4.2 管理機能
- 管理画面ログイン
- 新規図番登録
- 図番情報の編集（基本情報、作業ステップ、関連図番）
- PDF/プログラム/画像/動画ファイルの追加・削除
- 追記のステータス管理（active/merged）
- 監査ログの閲覧

### 4.3 追記情報機能
- 対象図番に対して、最新情報を追加できる
- 追記可能な形式: テキスト、画像、動画
- 公開版では厳密なロール分離を実装していないため、運用ルールで補完する

### 4.4 チャット機能（町工場GPT）
- 町工場GPT画面でチャット問い合わせ
- モデル選択
- 社内データ検索 ON/OFF 切替
- LocalLLM 環境を別途準備した場合のみ利用可能

## 5. 画面仕様（役割）
- `/`
  - トップ画面。会社選択、検索、最新追記、チャット遷移の入口
- `/category/[companyId]`
  - 会社内カテゴリの選択
- `/drawings/[companyId]/[category]`
  - カテゴリ内図番の選択
- `/instruction/[drawingNumber]`
  - 作業手順詳細の閲覧
- `/contributions/all`
  - 全追記の時系列閲覧
- `/chat`
  - 町工場GPT
- `/admin/login`
  - 管理画面ログイン
- `/admin`
  - 管理ダッシュボード
- `/admin/drawings/new`
  - 新規図番登録
- `/admin/drawings/list`
  - 図番検索・一覧・編集遷移
- `/admin/drawings/[id]/edit`
  - 図番編集
- `/admin/contributions`
  - 追記管理
- `/admin/audit-log`
  - 監査ログ閲覧

## 6. 基本利用フロー

### 6.1 閲覧フロー
1. トップで図番検索、または会社選択
2. 図番を選択
3. 作業手順詳細を閲覧

### 6.2 管理フロー
1. 管理画面ログイン
2. 新規登録または図番一覧から対象を選択
3. 編集内容を更新して保存
4. 必要に応じて追記管理・監査ログ確認

## 7. 公開版に含まれるデータ
- デモ用サンプルデータのみ
- サンプル図番: `DEMO-001`, `DEMO-002`, `DEMO-003`
- サンプル管理ユーザー情報あり（デモ用途）
- PDF / 画像 / 動画サンプルは、すべて生成AIで作成したデータ

## 8. 開発中の制約（現時点）
- 本版は開発中のデモ版
- 多言語切り替え機能は未実装
- 管理画面で「図番データの完全削除」は未実装
- 権限分離は今後の運用設計対象
- 運用時は必要に応じて、ファイル単位の手動削除やデータ修正で対応

## 9. 関連ドキュメント
- 初期セットアップと最短利用手順: `README.md`
- 画面別の具体操作手順: `doc/user-guide.md`
